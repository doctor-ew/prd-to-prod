# Milestone MS-02.01-B: Language Switcher Component

## Framework: C-R-A-F-T

### Context
We have successfully implemented the backend routing for internationalization. Users can access English or Spanish content by changing the URL manually, but there is no user interface to switch between languages. We need to provide a simple, intuitive control for users to toggle between supported languages.

### Resources
-   **Technology**: React, Next.js (`usePathname` hook, `<Link>` component), Tailwind CSS.
-   **Assets**: Simple text labels ("EN", "ES") will suffice; no icons are needed.

### Art Style
-   **UI**: The control should be a floating button or a set of links, similar to the traffic toggle, positioned in a corner of the map (e.g., top-right, near the other controls).
-   **State Indication**: The currently active language should be visually distinct (e.g., underlined, bold, or a different color) to provide clear feedback to the user.

### Theme
The theme is "effortless access." Switching languages should be a simple, one-click action that immediately updates the application's content to the user's preferred language.

### Form
-   A new client-side component (`'use client'`) named `LanguageSwitcher.tsx`.
-   This component will use the `usePathname` hook from `next/navigation` to determine the current language from the URL.
-   It will render Next.js `<Link>` components that preserve the current page path while only changing the language prefix.

---

## Learning Outcomes

-   **Outcome 1**: Learn how to create a UI control for internationalization routing in the Next.js App Router.
-   **Outcome 2**: Understand how to use client-side hooks like `usePathname` to create dynamic, context-aware navigation elements.
-   **Outcome 3**: Gain experience in building accessible navigation controls that provide clear visual feedback on the current state.

---

## Context from Source Docs

**Business Rationale (PRD)**: To "Allow users to switch languages seamlessly." This component is the primary user-facing implementation of that requirement.
**WBS Alignment**: Phase 3 -> Task 3.4 (Multilingual support).
**Dependencies**: MS-02.01-A (i18n Setup).
**Files to Create/Modify**:
-   `src/components/LanguageSwitcher.tsx` (new file)
-   `src/app/[lang]/(main)/layout.tsx` (to place the switcher)

**Acceptance Criteria**:
-   A UI control is visible on the page that allows users to select "English" or "Spanish".
-   Clicking a language option navigates the user to the correct URL (e.g., from `/en` to `/es`) without a full page reload.
-   The UI text on the page (e.g., "Upcoming Events") updates to the selected language.
-   The currently active language is visually highlighted in the switcher.

---

## Guardrails

-   **Technology**: You **must** use the Next.js `<Link>` component for navigation to enable client-side routing. Do not use a standard `<a>` tag. You **must** use the `usePathname` hook to get the current path.
-   **UX**: The switcher must be placed in a consistent, easy-to-find location. It must not obscure other important UI elements.
-   **Accessibility**: The links must be keyboard-focusable and have clear text labels.

---

## Implementation Checklist

-   [ ] **Task 1**: Create the `LanguageSwitcher` component.
    -   **Action**: Create a new file at `src/components/LanguageSwitcher.tsx`. Add the following code.
    ```tsx
    'use client';

    import { usePathname } from 'next/navigation';
    import Link from 'next/link';
    import { i18n } from '@/i18n/i18n-config';

    export default function LanguageSwitcher() {
      const pathName = usePathname();

      const redirectedPathName = (locale: string) => {
        if (!pathName) return '/';
        const segments = pathName.split('/');
        segments[1] = locale;
        return segments.join('/');
      };

      return (
        <div className="absolute top-14 right-4 bg-white p-1 rounded-md shadow-md flex space-x-2 text-sm">
          {i18n.locales.map((locale) => {
            const isActive = pathName.startsWith(`/${locale}`);
            return (
              <Link
                key={locale}
                href={redirectedPathName(locale)}
                className={`px-2 py-1 rounded-md ${isActive ? 'bg-blue-500 text-white' : 'hover:bg-gray-100'}`}
              >
                {locale.toUpperCase()}
              </Link>
            );
          })}
        </div>
      );
    }
    ```
    -   **Acceptance**: The `LanguageSwitcher.tsx` file is created.
-   [ ] **Task 2**: Add the `LanguageSwitcher` to the main layout.
    -   **Action**: To ensure the switcher appears on all pages, it should be placed in the layout. Open `src/app/[lang]/(main)/layout.tsx` and modify it.
    ```tsx
    // The existing layout only has `children` and `params`.
    // We will assume the layout's root element can be made relative for the switcher.
    // NOTE: This file might need to be created if it doesn't exist.
    // Let's assume the previous `RootLayout` was at `src/app/(main)/layout.tsx` and now
    // it's `src/app/[lang]/(main)/layout.tsx`.

    import LanguageSwitcher from '@/components/LanguageSwitcher';

    export default function MainLayout({
      children,
      params,
    }: {
      children: React.ReactNode;
      params: { lang: string };
    }) {
      return (
        // The html/body tags are likely in a higher-level root layout.
        // For this component, we'll add a div that allows positioning.
        <div className="relative h-full w-full">
            {/* The page content will be passed as children */}
            {children}
            <LanguageSwitcher />
        </div>
      );
    }
    ```
    -   **Clarification**: The `page.tsx` renders the map and event list. The layout wraps the page. For the absolute positioning of the switcher to work relative to the *page content*, the root element in the layout should contain it. We also need to adjust the `page.tsx`'s root `main` element to not create a new stacking context that would trap the absolutely positioned element. Let's provide a cleaner final `page` and `layout`.

    -   **Final Action for `layout.tsx`**: Replace the content of `src/app/[lang]/(main)/layout.tsx` with:
    ```tsx
    import LanguageSwitcher from '@/components/LanguageSwitcher';

     export default function MainLayout({ children }: { children: React.ReactNode }) {
        return (
            <>
                {children}
                <LanguageSwitcher />
            </>
        );
     }
    ```

    -    **Final Action for `page.tsx`**: Ensure the parent `main` tag in `src/app/[lang]/(main)/page.tsx` is the positioning context.
    ```tsx
    // In src/app/[lang]/(main)/page.tsx
    // ... imports

    export default async function Home(...) {
      // ... data fetching
      return (
        // Add "relative" here
        <main className="h-screen w-screen relative">
          <MapView />
          <EventList events={events} dictionary={dictionary} />
        </main>
      );
    }
    ```
    -    **Final Action for `LanguageSwitcher.tsx`**: Let's place it next to the traffic control. Change `top-14` to `top-4
    ` and `right-16` to `right-20`.
    ```tsx
    // In src/components/LanguageSwitcher.tsx
    // ...
    return <div className="absolute top-4 right-20 bg-white p-1 rounded-md shadow-md flex space-x-2 text-sm">{/*...*/}</div>
    ```
    -   **Acceptance**: The `LanguageSwitcher` component is added to the main layout, making it visible on the page.

---

## Testing Requirements

-   [ ] **Manual Verification**:
    1.  Run `pnpm dev`.
    2.  Open the application, which should redirect to `/en`.
    3.  **Confirm**: A language switcher with "EN" and "ES" is visible in the top-right corner. "EN" is highlighted.
    4.  Click "ES".
    5.  **Confirm**: The URL changes to `/es`.
    6.  **Confirm**: The text "Upcoming Events" changes to "Pr√≥ximos Eventos".
    7.  **Confirm**: The "ES" button in the switcher is now highlighted.
    8.  Click "EN" again to confirm it switches back correctly.

---

## Success Criteria

This milestone is complete when:
1.  A functional language switcher UI is present on the map screen.
2.  Users can switch between English and Spanish with a single click.
3.  The UI provides clear visual feedback of the currently active language.
4.  The solution correctly uses Next.js client-side routing.
5.  All acceptance criteria are met.

# Milestone MS-01.04-A: Update Database Schema for Events & Venues

## Framework: S-P-A-R-K

### Situation
Our application currently has no concept of "events" or "venues." The database is empty except for the initial user preference tables (which we will refine later). To show FIFA match schedules, we first need to define the data structure for events and venues in our database schema.

### Purpose
The goal is to update the Prisma schema to include `Event` and `Venue` models. This creates the necessary database tables to store FIFA-related information, which will be populated with data and displayed to the user in subsequent milestones.

### Audience
This prompt is for an AI coding assistant being guided by a non-technical user. The instructions must be followed exactly.

### Roadmap
1.  Open the `prisma/schema.prisma` file.
2.  Add the `Event` and `Venue` model definitions, including the relationship between them.
3.  Run the Prisma migration command to apply these changes to the local SQLite database.

### Knowledge
-   You will be editing the Prisma schema file, which uses Prisma's schema language.
-   An `Event` is held at a `Venue`, so a one-to-many relationship is needed (`Venue` can have many `Event`s).
-   The `pnpm prisma migrate dev` command compares the schema file to the database state and generates/applies the necessary SQL to update it.

---

## Learning Outcomes

-   **Outcome 1**: Learn how to define data models and relationships in a Prisma schema.
-   **Outcome 2**: Understand the iterative nature of database development by running a migration to alter an existing database structure.
-   **Outcome 3**: Establish the foundational data models for one of the application's core features: event discovery.

---

## Context from Source Docs

**Business Rationale (PRD)**: To allow users to browse FIFA match schedules and access detailed venue maps. This requires a structured way to store this information.
**WBS Alignment**: Phase 3 -> Task 3.5 (Event data ingestion and real-time updates). This is the first step.
**Dependencies**: MS-01.01 (Project Setup).
**Files to Create/Modify**:
-   `prisma/schema.prisma`

**Acceptance Criteria**:
-   The `Event` and `Venue` models are correctly defined in `prisma/schema.prisma`.
-   Running `pnpm prisma migrate dev` completes successfully.
-   A new migration file is created in the `prisma/migrations` directory.
-   The local `prisma/dev.db` file is updated to include the new `events` and `venues` tables.

---

## Guardrails

-   **Data & APIs**: The schema **must** match the definition provided in `docs/spec.md`. Do not add or remove fields.
-   **Code Quality**: Ensure the relationship between `Event` and `Venue` is correctly defined with a foreign key.
-   **Development Process**: Do not manually edit the SQLite database file. All changes **must** be made via a Prisma migration.

---

## Implementation Checklist

-   [ ] **Task 1**: Update the Prisma Schema.
    -   **Action**: Open `prisma/schema.prisma` and add the `Event` and `Venue` models. You can remove the existing `UserProfile` and `UserFavorite` models for now, as they will be re-introduced in a later, more detailed milestone. The final file should look like this:
    ```prisma
    generator client {
      provider = "prisma-client-js"
    }

    datasource db {
      provider = "sqlite"
      url      = "file:./dev.db"
    }

    model Event {
      id          String   @id @default(cuid())
      fifaEventId String   @unique
      name        String
      description String
      startTime   DateTime
      venueId     String
      venue       Venue    @relation(fields: [venueId], references: [id])
    }

    model Venue {
      id        String  @id @default(cuid())
      name      String
      address   String
      latitude  Float
      longitude Float
      events    Event[]
    }
    ```
    -   **Acceptance**: The `prisma/schema.prisma` file is updated with the new models.
-   [ ] **Task 2**: Run the database migration.
    -   **Action**: Run this exact command in the terminal: `pnpm prisma migrate dev --name event-venue-models`
    -   **Acceptance**: The command completes successfully. You see output indicating that a new migration has been created and applied.

---

## Testing Requirements

-   [ ] **Manual Verification**:
    1.  After the migration command finishes, check the `prisma/migrations` directory.
    2.  **Confirm**: A new folder exists with a name that includes `event-venue-models`.
    3.  **Confirm**: Inside that new folder, there is a `migration.sql` file.
    4.  (Optional) Open the `migration.sql` file and **confirm** it contains `CREATE TABLE "Event"` and `CREATE TABLE "Venue"` statements.

---

## Success Criteria

This milestone is complete when:
1.  The Prisma schema accurately reflects the data models for events and venues.
2.  A successful database migration has been generated and applied.
3.  The underlying SQLite database now contains the necessary tables to store event and venue data.
4.  All acceptance criteria are met.

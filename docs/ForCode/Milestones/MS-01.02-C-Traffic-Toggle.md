# Milestone MS-01.02-C: UI Controls & Traffic Toggle

## Framework: C-R-A-F-T

### Context
The map is functional but lacks interactivity beyond basic panning and zooming. To be truly useful, users need simple controls to toggle essential data layers. The most critical layer for navigating a major event is real-time traffic. This milestone adds a simple UI control to turn the Google Maps traffic layer on and off.

### Resources
-   **Technology**: React (`useState`), Google Maps JavaScript API (Traffic Layer), Tailwind CSS for styling.
-   **Assets**: A simple icon for a "layers" or "traffic" button (can be an SVG or an emoji).

### Art Style
-   **UI**: The control should be a floating action button (FAB) style, hovering in a corner of the map (e.g., top-right). It should be unobtrusive but easily discoverable.
-   **State Indication**: The button's appearance should change to indicate whether the traffic layer is currently active or inactive (e.g., change of color, different icon).

### Theme
The theme is "user control and clarity." Users should be able to easily access relevant map data without being overwhelmed. The control should be intuitive and provide immediate visual feedback.

### Form
-   The state of the traffic layer (on/off) will be managed within the `MapView` component using the `useState` hook.
-   A new `MapControl` component will be created for the button to keep the UI logic separate.
-   Conditional logic will be used to enable or disable the traffic layer on the map object.

---

## Learning Outcomes

-   **Outcome 1**: Learn how to manage UI state within a React client component using the `useState` hook.
-   **Outcome 2**: Understand how to interact with the underlying Google Map instance to dynamically change its properties, such as toggling data layers.
-   **Outcome 3**: Gain experience in building simple, floating UI controls that overlay a map, a common pattern in web mapping applications.

---

## Context from Source Docs

**Business Rationale (PRD)**: To provide real-time navigation and transportation information. Traffic conditions are a vital part of this, helping users make informed travel decisions.
**WBS Alignment**: Phase 3 -> Task 3.1 (Frontend development). This completes the core "Map Rendering" feature.
**Dependencies**: MS-01.02-B (Venue Marker).
**Files to Create/Modify**:
-   `src/components/MapControl.tsx` (new file)
-   `src/components/MapView.tsx`

**Acceptance Criteria**:
-   A control button is visible on the map, likely in the top-right corner.
-   Clicking the button toggles the Google Maps real-time traffic layer on and off.
-   The button's style changes to indicate the current state (on/off).
-   The traffic layer is off by default.

---

## Guardrails

-   **UX**: The control **must not** block or obscure important parts of the map. It should be placed in a standard position for map controls.
-   **Performance**: Toggling the layer should be instantaneous with no perceivable lag.
-   **Code Quality**: The button UI **must** be in its own `MapControl.tsx` component. The state management logic **must** reside in the parent `MapView.tsx` component.

---

## Implementation Checklist

-   [ ] **Task 1**: Create the `MapControl` button component.
    -   **Action**: Create a new file at `src/components/MapControl.tsx`. Add the following code. This is a simple, reusable button.
    ```tsx
    'use client';

    import React from 'react';

    type MapControlProps = {
      onClick: () => void;
      isActive: boolean;
      children: React.ReactNode;
    };

    const MapControl = ({ onClick, isActive, children }: MapControlProps) => {
      const baseClasses = "absolute top-4 right-4 bg-white p-2 rounded-md shadow-md cursor-pointer hover:bg-gray-100";
      const activeClasses = isActive ? "bg-blue-500 text-white hover:bg-blue-600" : "";

      return (
        <button onClick={onClick} className={`${baseClasses} ${activeClasses}`}>
          {children}
        </button>
      );
    };

    export default MapControl;
    ```
    -   **Acceptance**: The file `src/components/MapControl.tsx` is created with the specified content.
-   [ ] **Task 2**: Add state management and the traffic layer to `MapView`.
    -   **Action**: Open `src/components/MapView.tsx` and update it significantly to manage the traffic layer's state and include the new control.
    ```tsx
    'use client';

    import React, { useState, useEffect } from 'react';
    import { APIProvider, Map, useMap } from '@vis.gl/react-google-maps';
    import VenueMarker from './VenueMarker';
    import MapControl from './MapControl';

    // A child component to access the map instance
    const TrafficLayer = ({ showTraffic }: { showTraffic: boolean }) => {
      const map = useMap();

      useEffect(() => {
        if (!map) return;

        const trafficLayer = new google.maps.TrafficLayer();
        if (showTraffic) {
          trafficLayer.setMap(map);
        }

        // Cleanup function to remove the layer when the component unmounts or state changes
        return () => {
          trafficLayer.setMap(null);
        };
      }, [map, showTraffic]);

      return null;
    };

    const MapView = () => {
      const [showTraffic, setShowTraffic] = useState(false);
      const position = { lat: 33.7490, lng: -84.3880 };
      const stadiumPosition = { lat: 33.7555, lng: -84.4008 };

      return (
        <APIProvider apiKey={process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY!}>
          <div className="h-full w-full relative">
            <Map
              defaultCenter={position}
              defaultZoom={14}
              gestureHandling={'greedy'}
              disableDefaultUI={true}
              mapId="fifa-map-style"
            >
              <VenueMarker lat={stadiumPosition.lat} lng={stadiumPosition.lng} />
              <TrafficLayer showTraffic={showTraffic} />
            </Map>
            <MapControl onClick={() => setShowTraffic(!showTraffic)} isActive={showTraffic}>
              {/* Simple emoji for traffic light icon */}
              ðŸš¦
            </MapControl>
          </div>
        </APIProvider>
      );
    };

    export default MapView;
    ```
    -   **Acceptance**: `MapView.tsx` is updated to include the `useState` hook, the new `TrafficLayer` child component, and the `MapControl` button. The parent `div` is set to `relative` positioning to anchor the absolute-positioned button.

---

## Testing Requirements

-   [ ] **Manual Verification**:
    1.  Run `pnpm dev`.
    2.  Open the application in a browser.
    3.  **Confirm**: A button with a traffic light emoji (ðŸš¦) is visible in the top-right corner of the map.
    4.  **Confirm**: The map initially loads with no traffic data.
    5.  **Click the button**:
        -   **Confirm**: The button's background color changes to blue.
        -   **Confirm**: Real-time traffic data (green, yellow, red lines) appears on the roads.
    6.  **Click the button again**:
        -   **Confirm**: The button's background returns to white.
        -   **Confirm**: The traffic data disappears from the map.

---

## Success Criteria

This milestone is complete when:
1.  A UI control for toggling traffic is present and functional on the map.
2.  The control provides clear visual feedback about its current state (active/inactive).
3.  The state is managed correctly within the React component.
4.  All acceptance criteria are met and manual verification passes.

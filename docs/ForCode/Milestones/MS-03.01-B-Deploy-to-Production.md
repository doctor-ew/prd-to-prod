# Milestone MS-03.01-B: Deploy to Production and Run Migrations

## Framework: S-P-A-R-K

### Situation
The application is feature-complete for its MVP. It works perfectly in the development environment, and we have provisioned a production database. The final step is to deploy the application to Vercel, making it publicly accessible, and ensure the production database schema is up-to-date.

### Purpose
The goal is to successfully deploy the Atlanta FIFA Navigator to Vercel and run our Prisma migrations against the live Vercel Postgres database. This makes the application live and ready for users.

### Audience
This prompt is for an AI coding assistant or developer executing the final deployment steps.

### Roadmap
1.  Modify the `package.json` build script to include running Prisma migrations. This is the standard way to apply database changes during the Vercel deployment process.
2.  Push the latest code to the `main` branch on GitHub.
3.  Let Vercel's CI/CD automatically build and deploy the application.
4.  Verify the deployment was successful and that the production database was migrated correctly.

### Knowledge
-   Vercel's build process runs the `build` script defined in `package.json`.
-   We can chain commands in the build script. By adding `prisma migrate deploy` to the build step, we ensure our database is always in sync with our schema on every deployment.
-   `prisma migrate deploy` is the non-interactive command for applying migrations in a production environment.

---

## Learning Outcomes

-   **Outcome 1**: Learn the standard process for deploying a database-driven Next.js application to Vercel.
-   **Outcome 2**: Understand how to integrate database migrations into a CI/CD pipeline to automate production schema updates.
-   **Outcome 3**: Successfully transition an application from a development environment to a live, public-facing production environment.

---

## Context from Source Docs

**Business Rationale (PRD)**: The ultimate goal is to launch the application for public use. This milestone achieves that.
**WBS Alignment**: Phase 5: Deployment and Launch -> Task 5.1 & 5.2.
**Dependencies**: MS-03.01-A (Provision and Configure Production Database).
**Files to Create/Modify**:
-   `package.json`

**Acceptance Criteria**:
-   The application is successfully deployed to a Vercel URL.
-   The production database migrations run successfully during the build process.
-   The live application is functional and connects to the Vercel Postgres database.
-   All features (map, transit data, favorites) work in the production environment.

---

## Guardrails

-   **Deployment**: All production deployments **must** be handled by Vercel's automated CI/CD triggered by a git push. No manual deployments.
-   **Database**: **Must** use `prisma migrate deploy` in the build script. Do not use `prisma migrate dev`, which is for development only and can be destructive.
-   **Environment**: The Vercel deployment **must** use the environment variables configured in the Vercel dashboard, not the local `.env` file.

---

## Implementation Checklist

-   [ ] **Task 1**: Update the build script in `package.json`.
    -   **Action**: Open `package.json` and modify the `"build"` script to include the migration command.
    ```json
    "scripts": {
      "dev": "next dev",
      "build": "prisma generate && prisma migrate deploy && next build",
      "start": "next start",
      "lint": "next lint"
    }
    ```
    -   **Explanation**: `prisma generate` ensures the client is up-to-date. `prisma migrate deploy` applies any pending migrations to the production database. `next build` builds the application.
    -   **Acceptance**: The `build` script in `package.json` is updated.
-   [ ] **Task 2**: Commit and push all changes to GitHub.
    -   **Action**:
        1.  Commit all the changes you've made throughout these milestones to git.
        2.  Push the commits to the `main` (or `master`) branch of your GitHub repository.
    -   **Acceptance**: The code is pushed to GitHub.
-   [ ] **Task 3**: Monitor the deployment in Vercel.
    -   **Action**:
        1.  Open your Vercel dashboard.
        2.  You should see a new deployment in progress for your project.
        3.  Click on the deployment and view the build logs.
    -   **Acceptance**: The build process starts automatically. You can see the output from the `prisma migrate deploy` command in the logs, and it completes without errors. The deployment finishes successfully.

---

## Testing Requirements

-   [ ] **Manual Verification**:
    1.  Once the deployment is complete, open your production Vercel URL.
    2.  **Confirm**: The application loads successfully.
    3.  **Confirm**: The map, venue marker, and event list all appear correctly.
    4.  **Confirm**: The real-time transit markers (buses and trains) appear on the map. (This is the ultimate test that the production environment variables for the MARTA API are working).
    5.  **Confirm**: The language switcher and favorite features work as expected, proving the application is correctly connected to the production database.

---

## Success Criteria

This milestone is complete when:
1.  The application is live on a public Vercel URL.
2.  The production database schema is successfully migrated and up-to-date.
3.  All core features of the application are verified to be working in the production environment.
4.  All acceptance criteria are met.
